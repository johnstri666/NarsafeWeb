<!DOCTYPE html>
<html lang="id">
  <head>
    <link rel="icon" href="/Image/logo.png" type="image/x-icon" />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tantangan Empati 7 Hari</title>
    <!-- Bootstrap CSS -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Font Awesome -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet"
    />
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&family=Open+Sans:ital,wght@0,300..800;1,300..800&family=Roboto:ital,wght@0,100..900;1,100..900&display=swap"
      rel="stylesheet"
    />
    <!-- Animate.css -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"
    />

    <style>
      :root {
        --primary: #4361ee;
        --primary-dark: #3a56d4;
        --secondary: #4cc9f0;
        --accent: #7209b7;
        --success: #4caf50;
        --danger: #f72585;
        --warning: #f8961e;
        --light: #f8f9fa;
        --dark: #121212;
        --dark-secondary: #1c1c1ccb;
        --dark-tertiary: #000000;
        --gray: #333333;
        --text-primary: #ffffff;
        --text-secondary: #b0b0b0;
      }

      body {
        font-family: "Inter", sans-serif;
        background-color: var(--dark);
        color: var(--text-primary);
        min-height: 100vh;
        overflow-x: hidden;
      }

      /* Glassmorphism effect */
      .glass-card {
        background: rgba(30, 30, 30, 0.7);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border-radius: 16px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      }

      /* Floating navbar */
      .navbar {
        background: rgb(0, 0, 0);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        box-shadow: 0 4px 30px rgba(0, 0, 0, 0.3);
        padding: 10px 0;
        position: fixed;
        line-height: 2.5rem;
        width: 100%;
        top: 0;
        left: 0;
        z-index: 1000;
        transition: var(--transition);
      }

      .nav-link {
        color: var(--text-primary) !important;
        font-weight: 300;
        padding: 0.7rem 1.2rem !important;
        margin: 0 5px;
        transition: 0.5s ease;
      }

      .nav-link:hover {
        background-color: #022e5684;
      }

      .nav-link.active {
        background-color: rgba(5, 150, 208, 0.995);
        color: var(--accent-color) !important;
        font-weight: 500;
      }

      .nav-item .nav-link#currentWeekDisplay {
        background-color: #011324;
      }

      .container-main {
        max-width: 1000px;
        margin: 0 auto;
        padding: 100px 20px 40px;
      }

      /* Hero section */
      .hero {
        margin-top: 5rem;
        text-align: center;
        margin-bottom: 40px;
        position: relative;
      }

      .hero h1 {
        font-size: 2.5rem;
        font-weight: 500;
        margin-bottom: 15px;
        background: linear-gradient(90deg, var(--primary), var(--secondary));
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
      }

      .hero p {
        font-size: 1.1rem;
        color: var(--text-secondary);
        max-width: 700px;
        margin: 0 auto 30px;
      }

      /* Progress circle */
      .progress-circle {
        width: 200px;
        height: 200px;
        position: relative;
        margin: 0 auto 30px;
      }

      .progress-circle svg {
        width: 100%;
        height: 100%;
        transform: rotate(-90deg);
      }

      .progress-circle circle {
        fill: none;
        stroke: var(--dark-tertiary);
        stroke-width: 8;
        stroke-linecap: round;
      }

      .progress-circle circle.progress {
        stroke: url(#progressGradient);
        stroke-dasharray: 314;
        stroke-dashoffset: 314;
        transition: stroke-dashoffset 1s ease;
      }

      .progress-circle-text {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        text-align: center;
      }

      .progress-circle-text .percentage {
        font-size: 1.8rem;
        font-weight: 700;
        color: var(--text-primary);
      }

      .progress-circle-text .label {
        font-size: 0.8rem;
        color: var(--text-secondary);
      }

      /* Challenge cards */
      .challenge-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 20px;
        margin-bottom: 40px;
      }

      .challenge-card {
        position: relative;
        border-radius: 6px;
        padding: 25px;
        background: linear-gradient(
          135deg,
          var(--dark-tertiary),
          var(--dark-secondary)
        );
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
        transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
        overflow: hidden;
        border: 1px solid rgba(255, 255, 255, 0.05);
      }

      .challenge-card::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          135deg,
          rgba(67, 97, 238, 0.1) 0%,
          rgba(76, 201, 240, 0.05) 100%
        );
        z-index: 0;
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .challenge-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4);
      }

      .challenge-card:hover::before {
        opacity: 1;
      }

      .challenge-card.active {
        border-left: 5px solid var(--primary);
        background: linear-gradient(
          to right,
          var(--dark-tertiary) 0%,
          rgba(67, 97, 238, 0.1) 100%
        );
      }

      .challenge-card.completed {
        border-left: 8px solid rgb(0, 179, 249);
        background: linear-gradient(
          to right,
          rgba(1, 37, 49, 0.272) 0%,
          rgba(0, 104, 131, 0.543) 100%
        );
      }

      .challenge-card.failed {
        border-left: 5px solid #6c757d;
        background: linear-gradient(
          to right,
          var(--dark-tertiary) 0%,
          rgba(108, 117, 125, 0.1) 100%
        );
      }

      .challenge-card.locked {
        opacity: 0.7;
        pointer-events: none;
        filter: grayscale(50%);
      }

      .challenge-day {
        font-size: 1.1rem;
        font-weight: 600;
        margin-bottom: 10px;
        color: var(--secondary);
        display: flex;
        align-items: center;
      }

      .challenge-card.failed .challenge-day {
        color: #6c757d;
      }

      .challenge-title {
        font-size: 1.2rem;
        font-weight: 500;
        margin-bottom: 15px;
        color: var(--text-primary);
      }

      .challenge-desc {
        font-size: 0.95rem;
        color: var(--text-secondary);
        line-height: 1.6;
        margin-bottom: 20px;
      }

      .status-indicator {
        position: absolute;
        right: 20px;
        top: 20px;
        transition: transform 0.3s ease;
      }

      .status-indicator:hover {
        transform: scale(1.1);
      }

      /* Buttons */
      .btn-complete {
        background-color: #2300bc;
        color: white;
        border: none;
        font-weight: 500;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(67, 97, 238, 0.3);
        align-items: center;
        justify-content: center;
      }

      .btn-complete:hover {
        background-color: white;
        color: black;
      }

      /* Timer */
      .timer-container {
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 30px;
      }

      .timer-box {
        background: rgb(0, 0, 0);
        border-radius: 10px;
        padding: 15px 25px;
        display: flex;
        align-items: center;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      }

      .timer {
        font-size: 1.1rem;
        color: var(--secondary);
        font-weight: 500;
        display: flex;
        align-items: center;
      }

      .timer i {
        margin-right: 10px;
        font-size: 1.3rem;
      }

      /* Points display */
      .points-display {
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 30px;
      }

      .points-badge {
        background: linear-gradient(135deg, #4cc9f0, #024b8e);
        color: white;
        border-radius: 10px;
        padding: 12px 25px;
        font-size: 1.1rem;
        font-weight: 500;
        box-shadow: 0 5px 20px rgba(67, 97, 238, 0.3);
        display: flex;
        align-items: center;
      }

      .points-badge i {
        margin-right: 10px;
        font-size: 1.3rem;
      }

      /* Reflection section */
      .reflection-section {
        background: linear-gradient(
          135deg,
          var(--dark-tertiary),
          var(--dark-secondary)
        );
        border-radius: 16px;
        padding: 30px;
        margin-top: 40px;
        border-left: 5px solid var(--accent);
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        display: none;
      }

      .reflection-section h3 {
        font-size: 1.5rem;
        margin-bottom: 20px;
        color: var(--secondary);
        display: flex;
        align-items: center;
      }

      .reflection-section h3 i {
        margin-right: 10px;
      }

      .reflection-question {
        margin-bottom: 25px;
      }

      .reflection-question label {
        display: block;
        font-size: 1.1rem;
        margin-bottom: 10px;
        color: var(--text-primary);
      }

      .reflection-question textarea {
        width: 100%;
        background: var(--dark-secondary);
        border: 1px solid var(--gray);
        border-radius: 10px;
        padding: 15px;
        color: var(--text-primary);
        font-family: "Poppins", sans-serif;
        min-height: 100px;
        transition: all 0.3s ease;
      }

      .reflection-question textarea:focus {
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        outline: none;
      }

      .btn-submit {
        background: linear-gradient(135deg, var(--primary), var(--accent));
        color: white;
        border: none;
        border-radius: 50px;
        padding: 12px 30px;
        font-size: 1.1rem;
        font-weight: 500;
        transition: all 0.3s ease;
        box-shadow: 0 5px 20px rgba(67, 97, 238, 0.3);
        display: inline-flex;
        align-items: center;
        justify-content: center;
        position: relative;
        overflow: hidden;
      }

      .btn-submit:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 25px rgba(67, 97, 238, 0.4);
      }

      .btn-submit i {
        margin-right: 10px;
      }

      /* Notification Toast */
      .notification-toast {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: rgba(40, 40, 40, 0.9);
        backdrop-filter: blur(10px);
        color: white;
        padding: 15px 25px;
        border-radius: 10px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        z-index: 1000;
        transform: translateY(100px);
        opacity: 0;
        transition: all 0.3s ease;
      }

      .notification-toast.show {
        transform: translateY(0);
        opacity: 1;
      }

      .notification-toast.success {
        border-left: 4px solid #4caf50;
      }

      .notification-toast.warning {
        border-left: 4px solid #f8961e;
      }

      /* Floating particles background */
      .particles {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: -1;
        overflow: hidden;
      }

      .particle {
        position: absolute;
        background: rgba(76, 201, 240, 0.2);
        border-radius: 50%;
        animation: float linear infinite;
      }

      @keyframes float {
        0% {
          transform: translateY(0) rotate(0deg);
          opacity: 1;
        }
        100% {
          transform: translateY(-1000px) rotate(720deg);
          opacity: 0;
        }
      }

      /* Animations */
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes pulse {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.05);
        }
        100% {
          transform: scale(1);
        }
      }

      @keyframes ripple {
        0% {
          transform: scale(0, 0);
          opacity: 1;
        }
        20% {
          transform: scale(25, 25);
          opacity: 1;
        }
        100% {
          opacity: 0;
          transform: scale(40, 40);
        }
      }

      /* Responsive adjustments */
      @media (max-width: 768px) {
        .container-main {
          padding: 80px 15px 30px;
        }

        .hero h1 {
          font-size: 2rem;
        }

        .hero p {
          font-size: 1rem;
        }

        .challenge-grid {
          grid-template-columns: 1fr;
        }

        .timer-box,
        .points-badge {
          padding: 12px 20px;
        }

        .notification-toast {
          width: 90%;
          left: 5%;
          right: auto;
        }
      }
    </style>
  </head>
  <body>
    <!-- Floating particles background -->
    <div class="particles" id="particles"></div>

    <!-- Notification Toast -->
    <div id="notificationToast" class="notification-toast">
      <div class="toast-content"></div>
    </div>

    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark">
      <div class="container">
        <a class="navbar-brand" href="/index.html">
          <img src="/Image/Narsafe logo 2.png" width="95%" />
        </a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ms-auto">
            <li class="nav-item">
              <a class="nav-link" href="/index.html">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/selfreflection/index.html"
                >Self Check-In</a
              >
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/SelfStep/index.html">Self Step</a>
            </li>
            <li class="nav-item">
              <a class="nav-link active" href="">Weekly Challenge</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/Letter/index.html"
                >Letter to Yourself
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#" id="currentWeekDisplay">Minggu 1</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- Main Content -->
    <div class="container container-main">
      <!-- Hero Section -->
      <section class="hero animate__animated animate__fadeIn">
        <h1>Tantangan Empati 7 Hari</h1>
        <p>
          Latih kepekaan dan kepedulianmu dengan tantangan harian yang sederhana
          namun bermakna
        </p>

        <div class="points-display">
          <span class="points-badge">
            <i class="fas fa-star"></i
            ><span id="currentPoints">0</span>&nbsp;Poin
          </span>
        </div>

        <div class="progress-circle">
          <svg viewBox="0 0 100 100">
            <defs>
              <linearGradient
                id="progressGradient"
                x1="0%"
                y1="0%"
                x2="100%"
                y2="0%"
              >
                <stop offset="0%" stop-color="#4361ee" />
                <stop offset="100%" stop-color="#4cc9f0" />
              </linearGradient>
            </defs>
            <circle cx="50" cy="50" r="46" />
            <circle class="progress" cx="50" cy="50" r="46" />
          </svg>
          <div class="progress-circle-text">
            <div class="percentage" id="progressPercentage">0%</div>
            <div class="label">Progress</div>
          </div>
        </div>

        <div class="timer-container">
          <div class="timer-box">
            <div class="timer">
              <i class="far fa-clock"></i>Tantangan berakhir dalam&nbsp;
              <span id="dailyTimer"> 23:59:59</span>
            </div>
          </div>
        </div>
      </section>

      <!-- Challenges Grid -->
      <section class="challenge-grid">
        <!-- Day 1 -->
        <div
          class="challenge-card active animate__animated animate__fadeInUp"
          id="day1"
          style="animation-delay: 0.1s"
        >
          <div class="challenge-day">
            <i class="fas fa-calendar-day"></i>Hari 1
          </div>
          <div class="challenge-title">
            Fokus pada kebaikan orang lain hari ini
          </div>
          <div class="challenge-desc">
            Alihkan perhatian dari diri sendiri, cari hal positif yang bisa kamu
            apresiasi dari orang di sekitarmu.
          </div>
          <div class="status-indicator">
            <button class="btn btn-complete" onclick="completeChallenge(1)">
              <i class="fas fa-check"></i> Selesai
            </button>
          </div>
        </div>

        <!-- Day 2 -->
        <div
          class="challenge-card locked animate__animated animate__fadeInUp"
          id="day2"
          style="animation-delay: 0.2s"
        >
          <div class="challenge-day">
            <i class="fas fa-calendar-day"></i>Hari 2
          </div>
          <div class="challenge-title">Puji orang lain tanpa membandingkan</div>
          <div class="challenge-desc">
            Lihat kelebihan orang lain dan akui dengan tulus — tanpa merasa
            kalah.
          </div>
          <div class="status-indicator">
            <i class="fas fa-lock"></i>
          </div>
        </div>

        <!-- Day 3 -->
        <div
          class="challenge-card locked animate__animated animate__fadeInUp"
          id="day3"
          style="animation-delay: 0.3s"
        >
          <div class="challenge-day">
            <i class="fas fa-calendar-day"></i>Hari 3
          </div>
          <div class="challenge-title">
            Dengarkan tanpa langsung kasih opini
          </div>
          <div class="challenge-desc">
            Latih dirimu untuk hadir dan mendengarkan tanpa merasa harus jadi
            pusat solusi.
          </div>
          <div class="status-indicator">
            <i class="fas fa-lock"></i>
          </div>
        </div>

        <!-- Day 4 -->
        <div
          class="challenge-card locked animate__animated animate__fadeInUp"
          id="day4"
          style="animation-delay: 0.4s"
        >
          <div class="challenge-day">
            <i class="fas fa-calendar-day"></i>Hari 4
          </div>
          <div class="challenge-title">
            Minta pendapat orang lain dan benar-benar pertimbangkan
          </div>
          <div class="challenge-desc">
            Tunjukkan bahwa kamu menghargai pandangan orang lain, bukan hanya
            pendapat sendiri.
          </div>
          <div class="status-indicator">
            <i class="fas fa-lock"></i>
          </div>
        </div>

        <!-- Day 5 -->
        <div
          class="challenge-card locked animate__animated animate__fadeInUp"
          id="day5"
          style="animation-delay: 0.5s"
        >
          <div class="challenge-day">
            <i class="fas fa-calendar-day"></i>Hari 5
          </div>
          <div class="challenge-title">
            Biarkan orang lain bersinar hari ini
          </div>
          <div class="challenge-desc">
            Dukung temanmu tampil tanpa merasa harus ikut mencuri perhatian.
          </div>
          <div class="status-indicator">
            <i class="fas fa-lock"></i>
          </div>
        </div>

        <!-- Day 6 -->
        <div
          class="challenge-card locked animate__animated animate__fadeInUp"
          id="day6"
          style="animation-delay: 0.6s"
        >
          <div class="challenge-day">
            <i class="fas fa-calendar-day"></i>Hari 6
          </div>
          <div class="challenge-title">
            Ucapkan terima kasih kepada orang "kecil"
          </div>
          <div class="challenge-desc">
            Misal: petugas kebersihan, satpam, atau guru yang jarang disorot.
            Hargai semua peran.
          </div>
          <div class="status-indicator">
            <i class="fas fa-lock"></i>
          </div>
        </div>

        <!-- Day 7 -->
        <div
          class="challenge-card locked animate__animated animate__fadeInUp"
          id="day7"
          style="animation-delay: 0.7s"
        >
          <div class="challenge-day">
            <i class="fas fa-calendar-day"></i>Hari 7
          </div>
          <div class="challenge-title">
            Akui satu kelemahan diri dan tulis pelajarannya
          </div>
          <div class="challenge-desc">
            Refleksi: bukan untuk merasa rendah, tapi untuk tahu kamu juga
            manusia yang bisa berkembang.
          </div>
          <div class="status-indicator">
            <i class="fas fa-lock"></i>
          </div>
        </div>
      </section>

      <!-- Reflection Section -->
      <section class="reflection-section" id="reflectionSection">
        <h3><i class="fas fa-pen-fancy"></i>Refleksi Hari ke-7</h3>

        <div class="reflection-question">
          <label>Apa rasanya menjalani hari tanpa jadi pusat perhatian?</label>
          <textarea
            id="reflectionQuestion1"
            placeholder="Tuliskan perasaanmu di sini..."
          ></textarea>
        </div>

        <div class="reflection-question">
          <label
            >Hal apa yang kamu pelajari tentang dirimu selama tantangan
            ini?</label
          >
          <textarea
            id="reflectionQuestion2"
            placeholder="Bagikan pelajaran yang kamu dapatkan..."
          ></textarea>
        </div>

        <button type="button" class="btn-submit" onclick="submitReflection()">
          <i class="fas fa-paper-plane"></i>Kirim
        </button>
      </section>
    </div>

    <!-- Success Modal -->
    <div class="modal fade" id="successModal" tabindex="-1">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content glass-card">
          <div class="modal-header">
            <h5 class="modal-title">
              <i class="fas fa-check-circle text-success me-2"></i>Selamat!
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <p>Kamu telah berhasil menyelesaikan tantangan hari ini!</p>
            <p>
              Tantangan untuk hari berikutnya akan terbuka pada pukul 00.00
              besok.
            </p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn-submit" data-bs-dismiss="modal">
              <i class="fas fa-thumbs-up"></i> Mengerti
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Failure Modal -->
    <div class="modal fade" id="failureModal" tabindex="-1">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content glass-card">
          <div class="modal-header">
            <h5 class="modal-title">
              <i class="fas fa-exclamation-circle text-danger me-2"></i
              >Peringatan
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <p>Tantangan hari ini telah terlewat.</p>
            <p>
              Kamu tidak mendapatkan poin untuk hari ini. Tantangan berikutnya
              akan tersedia besok.
            </p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn-submit" data-bs-dismiss="modal">
              <i class="fas fa-check"></i> Mengerti
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Week Completion Modal -->
    <div class="modal fade" id="weekCompleteModal" tabindex="-1">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content glass-card">
          <div class="modal-header">
            <h5 class="modal-title">
              <i class="fas fa-trophy text-warning me-2"></i>Hebat!
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <p>
              Selamat! Kamu telah menyelesaikan Tantangan Empati minggu ini!
            </p>
            <p>
              PDF hasil tantangan dan refleksimu sedang diunduh secara otomatis.
            </p>
            <p>Minggu depan akan tersedia tantangan baru untuk kamu jalani.</p>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn-submit"
              data-bs-dismiss="modal"
              onclick="startNewWeek()"
            >
              <i class="fas fa-arrow-right"></i> Lanjutkan
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Bootstrap Bundle with Popper -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <!-- jsPDF for PDF generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <script>
      // Global variables
      let currentDay = 1;
      let currentWeek = 1;
      let dailyStatus = Array(7).fill(null);
      let lastCompletedDate = null;
      let isReflectionSubmitted = false;
      let isProcessing = false;
      let autoSkipInterval;

      // DOM Elements
      const currentPointsEl = document.getElementById("currentPoints");
      const reflectionSectionEl = document.getElementById("reflectionSection");
      const dailyTimerEl = document.getElementById("dailyTimer");
      const currentWeekDisplayEl =
        document.getElementById("currentWeekDisplay");
      const progressPercentageEl =
        document.getElementById("progressPercentage");
      const progressCircle = document.querySelector(
        ".progress-circle .progress"
      );
      const notificationToast = document.getElementById("notificationToast");

      // Initialize modals
      const successModal = new bootstrap.Modal(
        document.getElementById("successModal")
      );
      const failureModal = new bootstrap.Modal(
        document.getElementById("failureModal")
      );
      const weekCompleteModal = new bootstrap.Modal(
        document.getElementById("weekCompleteModal")
      );

      // Initialize the app
      function initApp() {
        loadSavedData();
        updateUI();
        updateTimer();
        setInterval(updateTimer, 1000);
        autoSkipInterval = setInterval(checkAutoAdvance, 60000); // Check every minute for auto-skip
      }

      // Show notification
      function showNotification(message, isSuccess = true) {
        const toast = notificationToast;
        const content = toast.querySelector(".toast-content");

        content.textContent = message;
        toast.className = `notification-toast ${
          isSuccess ? "success" : "warning"
        }`;
        toast.classList.add("show");

        setTimeout(() => {
          toast.classList.remove("show");
        }, 3000);
      }

      // Load saved data from localStorage
      function loadSavedData() {
        const saved = localStorage.getItem("empathyChallenge");
        if (saved) {
          const data = JSON.parse(saved);
          currentDay = data.currentDay || 1;
          currentWeek = data.currentWeek || 1;
          dailyStatus = data.dailyStatus || Array(7).fill(null);
          lastCompletedDate = data.lastCompletedDate || null;
          isReflectionSubmitted = data.isReflectionSubmitted || false;

          // If it's a new day, run auto-advance immediately
          if (lastCompletedDate) {
            const now = new Date();
            const lastDate = new Date(lastCompletedDate);
            if (now.toDateString() !== lastDate.toDateString()) {
              checkAutoAdvance();
            }
          }
        }
      }

      // Save data to localStorage
      function saveData() {
        const data = {
          currentDay,
          currentWeek,
          dailyStatus,
          lastCompletedDate,
          isReflectionSubmitted,
        };
        localStorage.setItem("empathyChallenge", JSON.stringify(data));
      }

      // Update UI based on current state
      function updateUI() {
        const points = dailyStatus.filter((status) => status === true).length;
        currentPointsEl.textContent = points;
        currentWeekDisplayEl.textContent = `Minggu ${currentWeek}`;

        const progress = Math.round((points / 7) * 100);
        progressCircle.style.strokeDashoffset = 314 - (314 * progress) / 100;
        progressPercentageEl.textContent = `${progress}%`;

        for (let i = 1; i <= 7; i++) {
          const el = document.getElementById(`day${i}`);
          if (!el) continue;

          const indicator = el.querySelector(".status-indicator");
          el.className = "challenge-card animate__animated animate__fadeInUp";
          indicator.innerHTML = "";

          if (dailyStatus[i - 1] === true) {
            el.classList.add("completed");
            indicator.innerHTML =
              '<i class="fas fa-check-circle text-success fa-lg"></i>';
          } else if (dailyStatus[i - 1] === false) {
            el.classList.add("failed");
            indicator.innerHTML =
              '<i class="fas fa-clock text-secondary"></i> Terlewat';
          } else if (i === currentDay) {
            el.classList.add("active");
            indicator.innerHTML = `
              <button class="btn btn-complete" onclick="completeChallenge(${i})">
                <i class="fas fa-check"></i> Selesai
              </button>
            `;
          } else {
            el.classList.add("locked");
            indicator.innerHTML = '<i class="fas fa-lock"></i>';
          }
        }

        // Show reflection section on day 7 if completed at least 5 challenges
        if (currentDay === 7 && points >= 5 && !isReflectionSubmitted) {
          reflectionSectionEl.style.display = "block";
        } else {
          reflectionSectionEl.style.display = "none";
        }
      }

      // Complete challenge function
      function completeChallenge(day) {
        if (isProcessing || day !== currentDay || dailyStatus[day - 1] !== null)
          return;

        isProcessing = true;
        dailyStatus[day - 1] = true;
        lastCompletedDate = new Date().toISOString();

        saveData();
        updateUI();

        // Show success notification
        showNotification(
          `Tantangan hari ${day} berhasil diselesaikan! +1 Poin`
        );

        // Show success modal
        successModal.show();

        setTimeout(() => {
          isProcessing = false;
        }, 500);
      }

      // Auto-skip and advance to next day
      function checkAutoAdvance() {
        const now = new Date();
        const todayKey = now.toDateString();

        // Initialize if first time
        if (!lastCompletedDate) {
          lastCompletedDate = now.toISOString();
          saveData();
          return;
        }

        const lastDate = new Date(lastCompletedDate).toDateString();

        // If it's a new day
        if (todayKey !== lastDate) {
          // Auto-skip current day if not completed
          if (dailyStatus[currentDay - 1] === null) {
            dailyStatus[currentDay - 1] = false;
            showNotification(`Tantangan hari ${currentDay} terlewat`, false);
            failureModal.show();
          }

          // Move to next day if available
          if (currentDay < 7) {
            currentDay++;
            lastCompletedDate = now.toISOString();
            saveData();
            updateUI();

            // Show notification for new challenge
            showNotification(`Tantangan hari ${currentDay} sudah tersedia!`);
          } else if (currentDay === 7) {
            // Stop checking if we've reached the last day
            clearInterval(autoSkipInterval);
          }
        }
      }

      // Update timer display
      function updateTimer() {
        const now = new Date();
        const tomorrow = new Date(now);
        tomorrow.setDate(tomorrow.getDate() + 1);
        tomorrow.setHours(0, 0, 0, 0);
        const diff = tomorrow - now;

        const h = Math.floor(diff / 3600000);
        const m = Math.floor((diff % 3600000) / 60000);
        const s = Math.floor((diff % 60000) / 1000);

        dailyTimerEl.textContent = `${String(h).padStart(2, "0")}:${String(
          m
        ).padStart(2, "0")}:${String(s).padStart(2, "0")}`;

        // Check for midnight exactly
        if (h === 0 && m === 0 && s === 0) {
          checkAutoAdvance();
        }
      }

      // Submit reflection
      function submitReflection() {
        const r1 = document.getElementById("reflectionQuestion1").value.trim();
        const r2 = document.getElementById("reflectionQuestion2").value.trim();

        if (r1.length < 20 || r2.length < 20) {
          showNotification(
            "Isi refleksi minimal 20 karakter untuk setiap pertanyaan",
            false
          );
          return;
        }

        isReflectionSubmitted = true;
        saveData();

        // Generate and download PDF
        generatePDF();

        // Show completion modal
        weekCompleteModal.show();
      }

      // Generate PDF (placeholder)
      function generatePDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();

        doc.text("Refleksi Tantangan Empati 7 Hari", 10, 10);
        doc.text(`Minggu ${currentWeek}`, 10, 20);

        // Add reflection answers
        doc.text(
          "1. Apa rasanya menjalani hari tanpa jadi pusat perhatian?",
          10,
          30
        );
        doc.text(document.getElementById("reflectionQuestion1").value, 10, 40);

        doc.text(
          "2. Hal apa yang kamu pelajari tentang dirimu selama tantangan ini?",
          10,
          60
        );
        doc.text(document.getElementById("reflectionQuestion2").value, 10, 70);

        // Add challenge results
        doc.text("Hasil Tantangan:", 10, 90);
        let yPos = 100;
        dailyStatus.forEach((status, index) => {
          const dayText = `Hari ${index + 1}: ${
            status === true
              ? "Selesai"
              : status === false
              ? "Terlewat"
              : "Belum"
          }`;
          doc.text(dayText, 10, yPos);
          yPos += 10;
        });

        doc.save(`Refleksi_Empati_Minggu_${currentWeek}.pdf`);
      }

      // Start new week
      function startNewWeek() {
        currentWeek++;
        currentDay = 1;
        dailyStatus = Array(7).fill(null);
        isReflectionSubmitted = false;
        lastCompletedDate = new Date().toISOString();
        saveData();
        updateUI();

        // Restart auto-skip interval
        clearInterval(autoSkipInterval);
        autoSkipInterval = setInterval(checkAutoAdvance, 60000);

        showNotification(`Tantangan Minggu ${currentWeek} dimulai!`);
      }

      // Reset challenge
      function resetChallenge() {
        if (
          confirm(
            "Apakah kamu yakin ingin mengulang minggu ini? Semua progress akan hilang."
          )
        ) {
          currentDay = 1;
          dailyStatus = Array(7).fill(null);
          isReflectionSubmitted = false;
          lastCompletedDate = new Date().toISOString();
          saveData();
          updateUI();

          // Restart auto-skip interval
          clearInterval(autoSkipInterval);
          autoSkipInterval = setInterval(checkAutoAdvance, 60000);

          showNotification("Tantangan telah direset! Mulai dari hari 1");
        }
      }

      // Initialize when DOM is loaded
      document.addEventListener("DOMContentLoaded", initApp);

      // Clean up intervals when page unloads
      window.addEventListener("beforeunload", () => {
        clearInterval(autoSkipInterval);
      });

      // Expose functions to global scope
      window.completeChallenge = completeChallenge;
      window.submitReflection = submitReflection;
      window.resetChallenge = resetChallenge;
      window.startNewWeek = startNewWeek;
    </script>
  </body>
</html>
